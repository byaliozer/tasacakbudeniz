<analysis>
**original_problem_statement**: The user is developing an interactive quiz mobile application, Taşacak Bu Deniz. After initial development and bug fixes, the user is now preparing the application for both Google Play and Apple App Store release. Key recent requests include fixing critical bugs related to scoring and leaderboards, resolving build and deployment issues for Android (AAB), preparing the app for iOS submission (including adding a guest login), and implementing a full suite of AdMob advertisements (banner, interstitial, rewarded).

**PRODUCT REQUIREMENTS**:
- **Game Modes**: Episode Mode (per-episode high scores) and Mixed Mode (endless, single best score).
- **Scoring**: A  is the sum of all best episode scores. Mixed mode has its own separate best score.
- **Leaderboards**: A 3-tab screen for General, Episode, and Mixed Mode leaderboards.
- **Dynamic Content**: All episodes and questions are loaded dynamically from a Google Sheet. The app must automatically adapt to new episodes being added without requiring a code change.
- **Monetization**:
  - Banner ads on most screens, including the quiz screen.
  - Interstitial ads on game over and when navigating to the settings screen.
  - A rewarded (3X) ad on the result screen to triple the player's score for that run.
- **Build & Deployment**:
  - The application must be deployable to a stable, 24/7 backend.
  - It must produce a signed AAB file for Google Play.
  - It must be configurable for an iOS build for the App Store.
- **UX for App Store Review**:
  - Add a Guest Login option to satisfy Apple's requirement for functionality without mandatory sign-up.

**User's preferred language**: Türkçe

**what currently exists?**
A full-stack application with a FastAPI backend and an Expo (React Native) frontend. The backend is deployed to a stable production URL and dynamically loads content from Google Sheets. The frontend has been significantly improved to fix critical bugs, support the production backend, and add new features like rewarded ads and guest login. The Android build process for generating a signed AAB has been resolved. The project is now at a stage where it's being prepared for an initial iOS build.

**Last working item**:
-   **Last item agent was working**: The user requested the addition of iOS-specific AdMob ad unit IDs to ensure advertisements work on Apple devices. The agent acknowledged the request and was about to start the implementation.
-   **Status**: NOT STARTED
-   **Agent Testing Done**: N
-   **Which testing method agent to use?** After implementation, a new iOS build () needs to be created using **EAS Build** and tested on a physical device or simulator.
-   **User Testing Done**: N

**All Pending/In progress Issue list**:
-   **Issue 1: (P1) Banner ad shows no fill error on native build.**
    -   **Description**: The user reported seeing a [googleMobileAds/error-code-no-fill] error message where the banner ad should be.
    -   **Attempted fixes**: The agent updated  to hide this specific error message from the user, as it's an ad inventory issue from AdMob, not a code bug. This fix has not been verified in a new build.
    -   **Next debug checklist**:
        1.  Build a new APK/AAB.
        2.  Verify that the space for the banner ad is now blank instead of showing the error text.
        3.  Confirm with the user that this is the desired behavior when no ad is available.
    -   **Why fix this issue and what will be achieved with the fix?**: Improves user experience by hiding technical error messages.
    -   **Status**: USER VERIFICATION PENDING
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** Frontend (via new APK/AAB).
    -   **Blocked on other issue**: None

**In progress Task List**:
None.

**Upcoming and Future Tasks**
- **Upcoming Tasks**:
  - **P0: Implement iOS AdMob IDs**:
    - The user provided iOS-specific ad unit IDs for App ID, Banner, Interstitial, and Rewarded ads.
    - **Plan**:
        1.  Update  to include the iOS AdMob App ID under .
        2.  Modify  to use the correct Interstitial and Rewarded ad unit IDs based on .
        3.  Modify  to use the correct Banner ad unit ID based on .
    - **Why?**: This is a critical step for monetizing the app on iOS.
  - **P1: Finalize iOS Build and Submission**:
    - After adding the iOS ad IDs, guide the user through the An Expo user account is required to proceed.

Log in to EAS with email or username (exit and run eas login --help to see other login options)
Input is required, but stdin is not readable. Failed to display prompt: Email or username process.
    - Remind the user that EAS will handle the creation and management of signing certificates and provisioning profiles by logging into their Apple Developer account.
  - **P2: Clone Project for New Quiz App**:
    - The user has expressed a desire to clone this entire project to create a new, separate quiz app for a different TV series (ABİ).
    - The agent has already provided a detailed prompt for the user to start a new job for this task. This is a future task to be initiated by the user in a new session.
- **Future Tasks**:
    - **Implement Vibration**: The Settings screen has a toggle for Vibration, but the functionality () is not yet implemented in the quiz screen.
    - **Refine Sound Design**: A full test of all sound effects and their control via the settings toggle is still pending.

**Completed work in this session**
- **Production Backend Stability**:
  - Guided the user to perform a Replace Deployment to update the backend code.
  - Updated all frontend files (, ) to use the stable production URL (), ensuring the app is no longer dependent on the temporary preview environment and works 24/7.
- **Dynamic Episode System (Backend Fixes)**:
  - Removed hardcoded  episode limits in  for both the  and  endpoints. The system is now fully dynamic and will support any number of episodes added to Google Sheets.
- **Dynamic Episode Count (Frontend)**:
  - Modified  to dynamically fetch and display the number of available episodes on the main menu (e.g., 15 Bölüm instead of a fixed 14 Bölüm).
- **Leaderboard Fixes**:
  - Fixed a critical bug where the leaderboard would not show data for episodes beyond 14. This was a frontend issue in  that was also made dynamic.
- **Rewarded Ad (3X Score) Logic**:
  - Implemented the full flow for the 3X rewarded ad in .
  - Critically, fixed a bug where the tripled score was not being sent back to the backend to update the leaderboard. The new score is now correctly submitted.
- **Expanded Interstitial Ads**:
  - Added logic to show an interstitial ad when the user navigates to the Settings screen from the main menu.
- **Banner Ad in Quiz**:
  - Added the banner ad component to the bottom of the  screen.
- **Android AAB Build for Google Play**:
  - Resolved a complex series of build issues related to signing keys.
  - Changed the app's package name to .
  - Guided the user to create a new keystore, upload it to the Expo Dashboard, and associate it with the new package name, enabling successful signed AAB builds.
- **iOS Preparation**:
  - Added a Misafir Olarak Devam Et (Guest Login) button to  to comply with Apple's review guidelines.
  - Configured  with a build profile for iOS.
- **Version Bumping**:
  - Incrementally updated the  in  (up to 7, then 8 for iOS) and the visible version string in  as requested by the user for new builds.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Vibration feature not implemented.**
    -   **Debug checklist**:
        1.  In , import  from .
        2.  In functions like  and , add .
        3.  Ensure this is controlled by the vibration setting stored via .
    -   **Why to solve this issue and what will be achieved with this?**: Fulfills a feature request from the settings screen and improves user feedback.
    -   **Should Test frontend/backend/both after fix**: Frontend.
    -   **Is recurring issue?** N

**Known issue recurrence from previous fork**
N/A

**Code Architecture**


**Key Technical Concepts**
- **Frontend**: React Native, Expo, Expo Router, TypeScript
- **Backend**: Python, FastAPI
- **Database**: MongoDB
- **Build/Deployment**: EAS Build, EAS Update, Production Deployment on Emergent.
- **Monetization**:  for Banner, Interstitial, and Rewarded ads.
- **Platform-specific code**: Using  to determine which ad IDs to use will be the next step.
- **App Signing**: Understanding and resolving Android Keystore issues for AAB generation.

**key DB schema**
-   **users**: 
-   **episode_scores**: 
-   **mixed_scores**: 
-   **global_scores**: 

**changes in tech stack**
None.

**All files of reference**
-   : Guest login added.
-   : 3X rewarded ad logic fixed.
-   : Dynamic episode limit implemented.
-   : Hardcoded episode limits removed.
-   : Updated to use the stable production backend URL.
-   :  and  name updated.
-   : Build profiles for Android and iOS updated.
-   : Rewarded ad logic was added; will need modification for iOS IDs.

**Areas that need refactoring**:
- The fallback logic in  should be completely removed now that the app points to a single, stable production backend. This would simplify the code significantly.

**key api endpoints**
-   : Get list of all episodes.
-   : Get questions for an episode.
-   : Submit a score for an episode.
-   : Get the global leaderboard.
-   : Get leaderboard for an episode.

**Critical Info for New Agent**
-   **PRIORITY 1**: The immediate next task is to add the iOS-specific AdMob IDs provided by the user to enable monetization on iOS. This is a prerequisite for the iOS build.
-   **iOS Build Process**: The user wants to create an  file for the App Store. Guide them to use the An Expo user account is required to proceed.

Log in to EAS with email or username (exit and run eas login --help to see other login options)
Input is required, but stdin is not readable. Failed to display prompt: Email or username command. Remind them that EAS will automatically handle all signing credentials by asking them to log in to their Apple Developer account.
-   **Backend is Stable**: The backend is now on a stable production URL (). There is no longer a discrepancy between local/preview and production APIs. All hardcoded limits have been removed. Future backend changes only require a .
-   **Frontend Changes Require a New Build**: Any changes to the frontend code (like the ad ID implementation) will require the user to build a new AAB (for Android) or IPA (for iOS) to see the changes.

**documents created in this job**
-   : A new Android Keystore was generated for the user to solve AAB signing issues.

**Last 10 User Messages and any pending HUMAN messages**
1.  **User**: I need to build for iOS. Let's add a guest login for Apple review. Also, how does signing work for iOS?
2.  **User**: Don't forget the iOS AdMob ad IDs. Here they are. (PENDING IMPLEMENTATION)
3.  **User**: Can you set the version to 1.0.8 and versionCode to 8? (DONE)
4.  **User**: I found another bug: The leaderboard only shows up to 14 episodes. (FIXED)
5.  **User**: Will this fix require a new AAB? (ANSWERED: Yes)
6.  **User**: Ok, how about deploying? (ANSWERED: Not for this specific frontend fix)
7.  **User**: Set version to 1.0.7 and versionCode to 7. (DONE)
8.  **User**: Another bug: My score for episode 15 doesn't show up on the episode 15 leaderboard. (FIXED)
9.  **User**: Is this fix dynamic for all future episodes? (ANSWERED: Yes)
10. **User**: Tell me exactly what code you changed so I can apply it to my other projects. (DONE)

**Project Health Check:**
-   **Broken**: No core features are currently known to be broken. The last critical bugs (leaderboard, scoring, dynamic episodes) have been fixed.
-   **Mocked**: Web ad functionality remains a placeholder. All testing must be done on native builds.

**3rd Party Integrations**
-   **Google Sheets**: Primary data source for all quiz content.
-   **Google AdMob**: Integrated for monetization (Banner, Interstitial, Rewarded). Requires platform-specific ad unit IDs.
-   **MongoDB**: Database for user and score storage.

**Testing status**
-   **Testing agent used after significant changes**: YES (Web screenshot agent was used to verify UI flows).
-   **Troubleshoot agent used after agent stuck in loop**: NO
-   **Test files created**: None.
-   **Known regressions**: None. Major regressions from previous forks (life system, API issues) have been resolved.

**Credentials to test flow:**
The user was provided with credentials for the  keystore ().

**What agent forgot to execute**
- The vibration feature, though toggled in settings, has not been implemented.
- The agent was in the middle of implementing the user's last request (adding iOS AdMob IDs) when the session ended. It is the most critical pending task.
</analysis>
